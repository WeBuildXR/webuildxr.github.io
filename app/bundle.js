!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"Component",(function(){return Component})),__webpack_require__.d(__webpack_exports__,"Not",(function(){return Not})),__webpack_require__.d(__webpack_exports__,"System",(function(){return System})),__webpack_require__.d(__webpack_exports__,"SystemStateComponent",(function(){return SystemStateComponent})),__webpack_require__.d(__webpack_exports__,"TagComponent",(function(){return TagComponent})),__webpack_require__.d(__webpack_exports__,"Types",(function(){return Types})),__webpack_require__.d(__webpack_exports__,"Version",(function(){return Version})),__webpack_require__.d(__webpack_exports__,"World",(function(){return World})),__webpack_require__.d(__webpack_exports__,"createComponentClass",(function(){return createComponentClass})),__webpack_require__.d(__webpack_exports__,"createType",(function(){return createType})),__webpack_require__.d(__webpack_exports__,"enableRemoteDevtools",(function(){return enableRemoteDevtools}));class SystemManager{constructor(e){this._systems=[],this._executeSystems=[],this.world=e,this.lastExecutedSystem=null}registerSystem(e,t){if(void 0!==this._systems.find(t=>t.constructor.name===e.name))return console.warn(`System '${e.name}' already registered.`),this;var n=new e(this.world,t);return n.init&&n.init(),n.order=this._systems.length,this._systems.push(n),n.execute&&(this._executeSystems.push(n),this.sortSystems()),this}sortSystems(){this._executeSystems.sort((e,t)=>e.priority-t.priority||e.order-t.order)}getSystem(e){return this._systems.find(t=>t instanceof e)}getSystems(){return this._systems}removeSystem(e){var t=this._systems.indexOf(e);~t&&this._systems.splice(t,1)}executeSystem(e,t,n){if(e.initialized&&e.canExecute()){let o=performance.now();e.execute(t,n),e.executeTime=performance.now()-o,this.lastExecutedSystem=e,e.clearEvents()}}stop(){this._executeSystems.forEach(e=>e.stop())}execute(e,t,n){this._executeSystems.forEach(o=>(n||o.enabled)&&this.executeSystem(o,e,t))}stats(){for(var e={numSystems:this._systems.length,systems:{}},t=0;t<this._systems.length;t++){var n=this._systems[t],o=e.systems[n.constructor.name]={queries:{}};for(var s in n.ctx)o.queries[s]=n.ctx[s].stats()}return e}}class EventDispatcher{constructor(){this._listeners={},this.stats={fired:0,handled:0}}addEventListener(e,t){let n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){return void 0!==this._listeners[e]&&-1!==this._listeners[e].indexOf(t)}removeEventListener(e,t){var n=this._listeners[e];if(void 0!==n){var o=n.indexOf(t);-1!==o&&n.splice(o,1)}}dispatchEvent(e,t,n){this.stats.fired++;var o=this._listeners[e];if(void 0!==o)for(var s=o.slice(0),r=0;r<s.length;r++)s[r].call(this,t,n)}resetCounters(){this.stats.fired=this.stats.handled=0}}function getName(e){return e.name}function componentPropertyName(e){var t=getName(e);return t.charAt(0).toLowerCase()+t.slice(1)}function queryKey(e){for(var t=[],n=0;n<e.length;n++){var o=e[n];if("object"==typeof o){var s="not"===o.operator?"!":o.operator;t.push(s+getName(o.Component))}else t.push(getName(o))}return t.sort().join("-")}class Query{constructor(e,t){if(this.Components=[],this.NotComponents=[],e.forEach(e=>{"object"==typeof e?this.NotComponents.push(e.Component):this.Components.push(e)}),0===this.Components.length)throw new Error("Can't create a query without components");this.entities=[],this.eventDispatcher=new EventDispatcher,this.reactive=!1,this.key=queryKey(e);for(var n=0;n<t._entities.length;n++){var o=t._entities[n];this.match(o)&&(o.queries.push(this),this.entities.push(o))}}addEntity(e){e.queries.push(this),this.entities.push(e),this.eventDispatcher.dispatchEvent(Query.prototype.ENTITY_ADDED,e)}removeEntity(e){let t=this.entities.indexOf(e);~t&&(this.entities.splice(t,1),t=e.queries.indexOf(this),e.queries.splice(t,1),this.eventDispatcher.dispatchEvent(Query.prototype.ENTITY_REMOVED,e))}match(e){return e.hasAllComponents(this.Components)&&!e.hasAnyComponents(this.NotComponents)}toJSON(){return{key:this.key,reactive:this.reactive,components:{included:this.Components.map(e=>e.name),not:this.NotComponents.map(e=>e.name)},numEntities:this.entities.length}}stats(){return{numComponents:this.Components.length,numEntities:this.entities.length}}}Query.prototype.ENTITY_ADDED="Query#ENTITY_ADDED",Query.prototype.ENTITY_REMOVED="Query#ENTITY_REMOVED",Query.prototype.COMPONENT_CHANGED="Query#COMPONENT_CHANGED";var nextId=0;class Entity{constructor(e){this._world=e||null,this.id=nextId++,this._ComponentTypes=[],this._components={},this._componentsToRemove={},this.queries=[],this._ComponentTypesToRemove=[],this.alive=!1}getComponent(e,t){var n=this._components[e.name];return n||!0!==t||(n=this._componentsToRemove[e.name]),n}getRemovedComponent(e){return this._componentsToRemove[e.name]}getComponents(){return this._components}getComponentsToRemove(){return this._componentsToRemove}getComponentTypes(){return this._ComponentTypes}getMutableComponent(e){for(var t=this._components[e.name],n=0;n<this.queries.length;n++){var o=this.queries[n];o.reactive&&-1!==o.Components.indexOf(e)&&o.eventDispatcher.dispatchEvent(Query.prototype.COMPONENT_CHANGED,this,t)}return t}addComponent(e,t){return this._world.entityAddComponent(this,e,t),this}removeComponent(e,t){return this._world.entityRemoveComponent(this,e,t),this}hasComponent(e,t){return!!~this._ComponentTypes.indexOf(e)||!0===t&&this.hasRemovedComponent(e)}hasRemovedComponent(e){return!!~this._ComponentTypesToRemove.indexOf(e)}hasAllComponents(e){for(var t=0;t<e.length;t++)if(!this.hasComponent(e[t]))return!1;return!0}hasAnyComponents(e){for(var t=0;t<e.length;t++)if(this.hasComponent(e[t]))return!0;return!1}removeAllComponents(e){return this._world.entityRemoveAllComponents(this,e)}reset(){this.id=nextId++,this._world=null,this._ComponentTypes.length=0,this.queries.length=0,this._components={}}remove(e){return this._world.removeEntity(this,e)}}class ObjectPool{constructor(e,t){this.freeList=[],this.count=0,this.T=e,this.isObjectPool=!0;var n=null;arguments.length>1&&(n=Array.prototype.slice.call(arguments)).shift(),this.createElement=n?()=>new e(...n):()=>new e,void 0!==t&&this.expand(t)}aquire(){return this.freeList.length<=0&&this.expand(Math.round(.2*this.count)+1),this.freeList.pop()}release(e){e.reset(),this.freeList.push(e)}expand(e){for(var t=0;t<e;t++)this.freeList.push(this.createElement());this.count+=e}totalSize(){return this.count}totalFree(){return this.freeList.length}totalUsed(){return this.count-this.freeList.length}}class QueryManager{constructor(e){this._world=e,this._queries={}}onEntityRemoved(e){for(var t in this._queries){var n=this._queries[t];-1!==e.queries.indexOf(n)&&n.removeEntity(e)}}onEntityComponentAdded(e,t){for(var n in this._queries){var o=this._queries[n];~o.NotComponents.indexOf(t)&&~o.entities.indexOf(e)?o.removeEntity(e):~o.Components.indexOf(t)&&o.match(e)&&!~o.entities.indexOf(e)&&o.addEntity(e)}}onEntityComponentRemoved(e,t){for(var n in this._queries){var o=this._queries[n];~o.NotComponents.indexOf(t)&&!~o.entities.indexOf(e)&&o.match(e)?o.addEntity(e):~o.Components.indexOf(t)&&~o.entities.indexOf(e)&&!o.match(e)&&o.removeEntity(e)}}getQuery(e){var t=queryKey(e),n=this._queries[t];return n||(this._queries[t]=n=new Query(e,this._world)),n}stats(){var e={};for(var t in this._queries)e[t]=this._queries[t].stats();return e}}class SystemStateComponent{}SystemStateComponent.isSystemStateComponent=!0;class EntityManager{constructor(e){this.world=e,this.componentsManager=e.componentsManager,this._entities=[],this._queryManager=new QueryManager(this),this.eventDispatcher=new EventDispatcher,this._entityPool=new ObjectPool(Entity),this.entitiesWithComponentsToRemove=[],this.entitiesToRemove=[],this.deferredRemovalEnabled=!0,this.numStateComponents=0}createEntity(){var e=this._entityPool.aquire();return e.alive=!0,e._world=this,this._entities.push(e),this.eventDispatcher.dispatchEvent(ENTITY_CREATED,e),e}entityAddComponent(e,t,n){if(!~e._ComponentTypes.indexOf(t)){e._ComponentTypes.push(t),t.__proto__===SystemStateComponent&&this.numStateComponents++;var o=this.world.componentsManager.getComponentsPool(t).aquire();if(e._components[t.name]=o,n)if(o.copy)o.copy(n);else for(var s in n)o[s]=n[s];this._queryManager.onEntityComponentAdded(e,t),this.world.componentsManager.componentAddedToEntity(t),this.eventDispatcher.dispatchEvent(COMPONENT_ADDED,e,t)}}entityRemoveComponent(e,t,n){var o=e._ComponentTypes.indexOf(t);if(~o){if(this.eventDispatcher.dispatchEvent(COMPONENT_REMOVE,e,t),n)this._entityRemoveComponentSync(e,t,o);else{0===e._ComponentTypesToRemove.length&&this.entitiesWithComponentsToRemove.push(e),e._ComponentTypes.splice(o,1),e._ComponentTypesToRemove.push(t);var s=getName(t);e._componentsToRemove[s]=e._components[s],delete e._components[s]}this._queryManager.onEntityComponentRemoved(e,t),t.__proto__===SystemStateComponent&&(this.numStateComponents--,0!==this.numStateComponents||e.alive||e.remove())}}_entityRemoveComponentSync(e,t,n){e._ComponentTypes.splice(n,1);var o=componentPropertyName(t),s=getName(t),r=e._components[s];delete e._components[s],this.componentsManager._componentPool[o].release(r),this.world.componentsManager.componentRemovedFromEntity(t)}entityRemoveAllComponents(e,t){let n=e._ComponentTypes;for(let o=n.length-1;o>=0;o--)n[o].__proto__!==SystemStateComponent&&this.entityRemoveComponent(e,n[o],t)}removeEntity(e,t){var n=this._entities.indexOf(e);if(!~n)throw new Error("Tried to remove entity not in list");e.alive=!1,0===this.numStateComponents&&(this.eventDispatcher.dispatchEvent(ENTITY_REMOVED,e),this._queryManager.onEntityRemoved(e),!0===t?this._releaseEntity(e,n):this.entitiesToRemove.push(e)),this.entityRemoveAllComponents(e,t)}_releaseEntity(e,t){this._entities.splice(t,1),e._world=null,this._entityPool.release(e)}removeAllEntities(){for(var e=this._entities.length-1;e>=0;e--)this.removeEntity(this._entities[e])}processDeferredRemoval(){if(this.deferredRemovalEnabled){for(let e=0;e<this.entitiesToRemove.length;e++){let t=this.entitiesToRemove[e],n=this._entities.indexOf(t);this._releaseEntity(t,n)}this.entitiesToRemove.length=0;for(let o=0;o<this.entitiesWithComponentsToRemove.length;o++){let s=this.entitiesWithComponentsToRemove[o];for(;s._ComponentTypesToRemove.length>0;){let o=s._ComponentTypesToRemove.pop();var e=componentPropertyName(o),t=getName(o),n=s._componentsToRemove[t];delete s._componentsToRemove[t],this.componentsManager._componentPool[e].release(n),this.world.componentsManager.componentRemovedFromEntity(o)}}this.entitiesWithComponentsToRemove.length=0}}queryComponents(e){return this._queryManager.getQuery(e)}count(){return this._entities.length}stats(){var e={numEntities:this._entities.length,numQueries:Object.keys(this._queryManager._queries).length,queries:this._queryManager.stats(),numComponentPool:Object.keys(this.componentsManager._componentPool).length,componentPool:{},eventDispatcher:this.eventDispatcher.stats};for(var t in this.componentsManager._componentPool){var n=this.componentsManager._componentPool[t];e.componentPool[t]={used:n.totalUsed(),size:n.count}}return e}}const ENTITY_CREATED="EntityManager#ENTITY_CREATE",ENTITY_REMOVED="EntityManager#ENTITY_REMOVED",COMPONENT_ADDED="EntityManager#COMPONENT_ADDED",COMPONENT_REMOVE="EntityManager#COMPONENT_REMOVE";class DummyObjectPool{constructor(e){this.isDummyObjectPool=!0,this.count=0,this.used=0,this.T=e}aquire(){return this.used++,this.count++,new this.T}release(){this.used--}totalSize(){return this.count}totalFree(){return 1/0}totalUsed(){return this.used}}class ComponentManager{constructor(){this.Components={},this._componentPool={},this.numComponents={}}registerComponent(e){this.Components[e.name]?console.warn(`Component type: '${e.name}' already registered.`):(this.Components[e.name]=e,this.numComponents[e.name]=0)}componentAddedToEntity(e){this.Components[e.name]||this.registerComponent(e),this.numComponents[e.name]++}componentRemovedFromEntity(e){this.numComponents[e.name]--}getComponentsPool(e){var t=componentPropertyName(e);return this._componentPool[t]||(e.prototype.reset?this._componentPool[t]=new ObjectPool(e):(console.warn(`Component '${e.name}' won't benefit from pooling because 'reset' method was not implemeneted.`),this._componentPool[t]=new DummyObjectPool(e))),this._componentPool[t]}}var name="ecsy",version="0.2.0",description="Entity Component System in JS",main="build/ecsy.js",module="build/ecsy.module.js",types="src/index.d.ts",scripts={build:"rollup -c && npm run docs",docs:"rm docs/api/_sidebar.md; typedoc --readme none --mode file --excludeExternals --plugin typedoc-plugin-markdown  --theme docs/theme --hideSources --hideBreadcrumbs --out docs/api/ --includeDeclarations --includes 'src/**/*.d.ts' src; touch docs/api/_sidebar.md","dev:docs":"nodemon -e ts -x 'npm run docs' -w src",dev:"concurrently --names 'ROLLUP,DOCS,HTTP' -c 'bgBlue.bold,bgYellow.bold,bgGreen.bold' 'rollup -c -w -m inline' 'npm run dev:docs' 'npm run dev:server'","dev:server":"http-server -c-1 -p 8080 --cors",lint:"eslint src test examples",start:"npm run dev",test:"ava",travis:"npm run lint && npm run test && npm run build","watch:test":"ava --watch"},repository={type:"git",url:"git+https://github.com/fernandojsg/ecsy.git"},keywords=["ecs","entity component system"],author="Fernando Serrano <fernandojsg@gmail.com> (http://fernandojsg.com)",license="MIT",bugs={url:"https://github.com/fernandojsg/ecsy/issues"},ava={files:["test/**/*.test.js"],sources:["src/**/*.js"],require:["babel-register","esm"]},jspm={files:["package.json","LICENSE","README.md","build/ecsy.js","build/ecsy.min.js","build/ecsy.module.js"],directories:{}},homepage="https://github.com/fernandojsg/ecsy#readme",devDependencies={ava:"^1.4.1","babel-cli":"^6.26.0","babel-core":"^6.26.3","babel-eslint":"^10.0.3","babel-loader":"^8.0.6",concurrently:"^4.1.2","docsify-cli":"^4.4.0",eslint:"^5.16.0","eslint-config-prettier":"^4.3.0","eslint-plugin-prettier":"^3.1.1","http-server":"^0.11.1",nodemon:"^1.19.4",prettier:"^1.19.1",rollup:"^1.27.8","rollup-plugin-json":"^4.0.0","rollup-plugin-terser":"^5.1.2",typedoc:"^0.15.3","typedoc-plugin-markdown":"^2.2.11",typescript:"^3.7.2"},pjson={name:name,version:version,description:description,main:main,"jsnext:main":"build/ecsy.module.js",module:module,types:types,scripts:scripts,repository:repository,keywords:keywords,author:author,license:license,bugs:bugs,ava:ava,jspm:jspm,homepage:homepage,devDependencies:devDependencies};const Version=pjson.version;class World{constructor(){if(this.componentsManager=new ComponentManager(this),this.entityManager=new EntityManager(this),this.systemManager=new SystemManager(this),this.enabled=!0,this.eventQueues={},"undefined"!=typeof CustomEvent){var e=new CustomEvent("ecsy-world-created",{detail:{world:this,version:Version}});window.dispatchEvent(e)}this.lastTime=performance.now()}registerComponent(e){return this.componentsManager.registerComponent(e),this}registerSystem(e,t){return this.systemManager.registerSystem(e,t),this}getSystem(e){return this.systemManager.getSystem(e)}getSystems(){return this.systemManager.getSystems()}execute(e,t){if(!e){let t=performance.now();e=t-this.lastTime,this.lastTime=t}this.enabled&&(this.systemManager.execute(e,t),this.entityManager.processDeferredRemoval())}stop(){this.enabled=!1}play(){this.enabled=!0}createEntity(){return this.entityManager.createEntity()}stats(){var e={entities:this.entityManager.stats(),system:this.systemManager.stats()};console.log(JSON.stringify(e,null,2))}}class System{canExecute(){if(0===this._mandatoryQueries.length)return!0;for(let e=0;e<this._mandatoryQueries.length;e++){if(0===this._mandatoryQueries[e].entities.length)return!1}return!0}constructor(e,t){if(this.world=e,this.enabled=!0,this._queries={},this.queries={},this.priority=0,this.executeTime=0,t&&t.priority&&(this.priority=t.priority),this._mandatoryQueries=[],this.initialized=!0,this.constructor.queries)for(var n in this.constructor.queries){var o=this.constructor.queries[n],s=o.components;if(!s||0===s.length)throw new Error("'components' attribute can't be empty in a query");var r=this.world.entityManager.queryComponents(s);this._queries[n]=r,!0===o.mandatory&&this._mandatoryQueries.push(r),this.queries[n]={results:r.entities};const e={added:Query.prototype.ENTITY_ADDED,removed:Query.prototype.ENTITY_REMOVED,changed:Query.prototype.COMPONENT_CHANGED};o.listen&&["added","removed","changed"].forEach(t=>{if(o.listen[t]){let s=o.listen[t];if("changed"===t){if(r.reactive=!0,!0===s){let e=this.queries[n][t]=[];r.eventDispatcher.addEventListener(Query.prototype.COMPONENT_CHANGED,t=>{-1===e.indexOf(t)&&e.push(t)})}else if(Array.isArray(s)){let e=this.queries[n][t]=[];r.eventDispatcher.addEventListener(Query.prototype.COMPONENT_CHANGED,(t,n)=>{-1!==s.indexOf(n.constructor)&&-1===e.indexOf(t)&&e.push(t)})}}else{let o=this.queries[n][t]=[];r.eventDispatcher.addEventListener(e[t],e=>{-1===o.indexOf(e)&&o.push(e)})}}})}}stop(){this.executeTime=0,this.enabled=!1}play(){this.enabled=!0}clearEvents(){for(let t in this.queries){var e=this.queries[t];if(e.added&&(e.added.length=0),e.removed&&(e.removed.length=0),e.changed)if(Array.isArray(e.changed))e.changed.length=0;else for(let t in e.changed)e.changed[t].length=0}}toJSON(){var e={name:this.constructor.name,enabled:this.enabled,executeTime:this.executeTime,priority:this.priority,queries:{}};if(this.constructor.queries){var t=this.constructor.queries;for(let n in t){let o=this.queries[n],s=t[n],r=e.queries[n]={key:this._queries[n].key};if(r.mandatory=!0===s.mandatory,r.reactive=s.listen&&(!0===s.listen.added||!0===s.listen.removed||!0===s.listen.changed||Array.isArray(s.listen.changed)),r.reactive){r.listen={};["added","removed","changed"].forEach(e=>{o[e]&&(r.listen[e]={entities:o[e].length})})}}}return e}}function Not(e){return{operator:"not",Component:e}}class Component{}Component.isComponent=!0;class TagComponent{reset(){}}function createType(e){var t=["create","reset","clear"].filter(t=>!e[t]);if(t.length>0)throw new Error("createType expect type definition to implements the following functions: "+t.join(", "));return e.isType=!0,e}TagComponent.isTagComponent=!0;var Types={};Types.Number=createType({baseType:Number,isSimpleType:!0,create:e=>void 0!==e?e:0,reset:(e,t,n)=>{e[t]=void 0!==n?n:0},clear:(e,t)=>{e[t]=0}}),Types.Boolean=createType({baseType:Boolean,isSimpleType:!0,create:e=>void 0!==e&&e,reset:(e,t,n)=>{e[t]=void 0!==n&&n},clear:(e,t)=>{e[t]=!1}}),Types.String=createType({baseType:String,isSimpleType:!0,create:e=>void 0!==e?e:"",reset:(e,t,n)=>{e[t]=void 0!==n?n:""},clear:(e,t)=>{e[t]=""}}),Types.Array=createType({baseType:Array,create:e=>void 0!==e?e.slice():[],reset:(e,t,n)=>{void 0!==n?e[t]=n.slice():e[t].length=0},clear:(e,t)=>{e[t].length=0},copy:(e,t,n)=>{e[n]=t[n].slice()}});var standardTypes={number:Types.Number,boolean:Types.Boolean,string:Types.String};function inferType(e){return Array.isArray(e)?Types.Array:standardTypes[typeof e]?standardTypes[typeof e]:null}function createComponentClass(e,t){for(let t in e){e[t].type||(e[t].type=inferType(e[t].default))}var n=function(){for(let n in e){var t=e[n];let o=t.type;o&&o.isType?this[n]=o.create(t.default):this[n]=t.default}};void 0!==t&&Object.defineProperty(n,"name",{value:t}),n.prototype.schema=e;var o=!0;for(let t in e){var s=e[t];s.type||(s.type=inferType(s.default)),s.type||(console.warn(`Unknown type definition for attribute '${t}'`),o=!1)}if(o){n.prototype.copy=function(t){for(let n in e)if(t[n]){let o=e[n].type;o.isSimpleType?this[n]=t[n]:o.copy?o.copy(this,t,n):console.warn(`Unknown copy function for attribute '${n}' data type`)}},n.prototype.reset=function(){for(let t in e){let n=e[t],o=n.type;o.reset&&o.reset(this,t,n.default)}},n.prototype.clear=function(){for(let t in e){let n=e[t].type;n.clear&&n.clear(this,t)}};for(let t in e){let o=e[t],s=o.type;n.prototype[t]=o.default,s.reset&&s.reset(n.prototype,t,o.default)}}else for(var r in console.warn("This component can't use pooling because some data types are not registered. Please provide a type created with 'createType'"),e){let t=e[r];n.prototype[r]=t.default}return n}function generateId(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",o=n.length,s=0;s<e;s++)t+=n.charAt(Math.floor(Math.random()*o));return t}function injectScript(e,t){var n=document.createElement("script");n.src=e,n.onload=t,(document.head||document.documentElement).appendChild(n)}function hookConsoleAndErrors(e){["error","warning","log"].forEach(t=>{if("function"==typeof console[t]){var n=console[t].bind(console);console[t]=(...o)=>(e.send({method:"console",type:t,args:JSON.stringify(o)}),n.apply(null,o))}}),window.addEventListener("error",t=>{e.send({method:"error",error:JSON.stringify({message:t.error.message,stack:t.error.stack})})})}function includeRemoteIdHTML(e){let t=document.createElement("div");return t.style.cssText="\n    align-items: center;\n    background-color: #333;\n    color: #aaa;\n    display:flex;\n    font-family: Arial;\n    font-size: 1.1em;\n    height: 40px;\n    justify-content: center;\n    left: 0;\n    opacity: 0.9;\n    position: absolute;\n    right: 0;\n    text-align: center;\n    top: 0;\n  ",t.innerHTML=`Open ECSY devtools to connect to this page using the code:&nbsp;<b style="color: #fff">${e}</b>&nbsp;<button onClick="generateNewCode()">Generate new code</button>`,document.body.appendChild(t),t}function enableRemoteDevtools(remoteId){window.generateNewCode=()=>{window.localStorage.clear(),remoteId=generateId(6),window.localStorage.setItem("ecsyRemoteId",remoteId),window.location.reload(!1)},remoteId=remoteId||window.localStorage.getItem("ecsyRemoteId"),remoteId||(remoteId=generateId(6),window.localStorage.setItem("ecsyRemoteId",remoteId));let infoDiv=includeRemoteIdHTML(remoteId);window.__ECSY_REMOTE_DEVTOOLS_INJECTED=!0,window.__ECSY_REMOTE_DEVTOOLS={};let Version="",worldsBeforeLoading=[],onWorldCreated=e=>{var t=e.detail.world;Version=e.detail.version,worldsBeforeLoading.push(t)};window.addEventListener("ecsy-world-created",onWorldCreated);let onLoaded=()=>{var peer=new Peer(remoteId);peer.on("open",()=>{peer.on("connection",connection=>{window.__ECSY_REMOTE_DEVTOOLS.connection=connection,connection.on("open",(function(){infoDiv.innerHTML="Connected",connection.on("data",(function(data){if("init"===data.type){var script=document.createElement("script");script.setAttribute("type","text/javascript"),script.onload=()=>{script.parentNode.removeChild(script),window.removeEventListener("ecsy-world-created",onWorldCreated),worldsBeforeLoading.forEach(e=>{var t=new CustomEvent("ecsy-world-created",{detail:{world:e,version:Version}});window.dispatchEvent(t)})},script.innerHTML=data.script,(document.head||document.documentElement).appendChild(script),script.onload(),hookConsoleAndErrors(connection)}else if("executeScript"===data.type){let value=eval(data.script);data.returnEval&&connection.send({method:"evalReturn",value:value})}}))}))})})};injectScript("https://cdn.jsdelivr.net/npm/peerjs@0.3.20/dist/peer.min.js",onLoaded)}const urlParams=new URLSearchParams(window.location.search);urlParams.has("enable-remote-devtools")&&enableRemoteDevtools()},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(9),t),s(n(10),t),s(n(15),t),s(n(16),t),s(n(17),t),s(n(18),t),s(n(19),t),s(n(20),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.disposeObject=t.updateObjectTransform=t.updateObjectsTransform=t.getObjectComponents=t.updateObjectVector3=t.updateObjectValue=void 0;const o=n(10),s=n(4);function r(e,t){let n=t.object;n.position&&(n.position=s.xyzToVector3(e.position)),n.rotation&&(n.rotation=s.xyzToVector3Radians(e.rotation)),n.scaling&&(n.scaling=s.xyzToVector3(e.scale))}t.updateObjectValue=function(e,t){e.object[t]=e[t]},t.updateObjectVector3=function(e,t){e.object[t]=s.xyzToVector3(e[t])},t.getObjectComponents=function(e){let t=e.getComponents(),n=[];for(let e in t){let o=t[e];o.object&&n.push(o)}return n},t.updateObjectsTransform=function(e){let t=e.getComponents();for(let n in t){let s=t[n];s.object&&e.hasComponent(o.Transform)&&r(e.getMutableComponent(o.Transform),s)}},t.updateObjectTransform=r,t.disposeObject=function(e){e.object&&e.object.dispose()}},function(e,t){e.exports=BABYLON},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.xyz=t.xyzToVector3Radians=t.xyzToVector3=t.degreeToRadians=void 0;const o=n(3);function s(e){return o.Angle.FromDegrees(e).radians()}t.degreeToRadians=s,t.xyzToVector3=function(e){return new o.Vector3(e.x,e.y,e.z)},t.xyzToVector3Radians=function(e){return new o.Vector3(s(e.x),s(e.y),s(e.z))},t.xyz=function(e,t,n){return e&&t&&n?{x:e,y:t,z:n}:{x:0,y:0,z:0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getAssetManager=t.getScene=t.getScenes=t.getRenderingCanvas=t.getSystem=void 0;const o=n(11),s=n(7),r=n(9);function i(e,t){return o.getWorld(e).getSystem(t)}t.getSystem=i,t.getRenderingCanvas=function(e){return i(e,s.GameSystem).renderingCanvas},t.getScenes=function(e){return i(e,s.GameSystem).scenes},t.getScene=function(e,t){return t?t.getComponent(r.Scene).object:i(e,s.GameSystem).activeScene},t.getAssetManager=function(e,t){return i(e,s.GameSystem).getAssetManager(t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hexToColor4=t.hexToColor3=t.materialColorHex=t.updateTexture=void 0;const o=n(3),s=n(2);t.updateTexture=function(e,t,n){for(let o in t){let r=t[o];n.addTextureTask(o,r.url).onSuccess=t=>{let n=t.texture;for(let e in r)"url"!==e&&(n[e]=r[e]);let i=o+"Texture",a=e.object;a[i]&&s.disposeObject(a[i]),a[i]=n}}n.load(),n.reset()},t.materialColorHex=function(e){return e?{diffuse:e}:{diffuse:"#ffffff"}},t.hexToColor3=function(e){return o.Color3.FromHexString(e)},t.hexToColor4=function(e){return o.Color4.FromHexString(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameSystem=void 0;const o=n(3),s=n(0),r=n(1),i=n(11),a=n(2),c=n(6);class u extends s.System{constructor(){super(...arguments),this._assetManagers=new Map,this.onSceneSwitched=new o.Observable}get renderingCanvas(){return this._engine.getRenderingCanvas()}get scenes(){return this._engine.scenes}get activeScene(){return this._activeScene}init(){this._render=this._render.bind(this)}execute(){this.queries.scene.added.forEach(e=>{let t=e.getComponent(r.Scene);t.object=new o.Scene(this._engine,t.options),1===this._engine.scenes.length&&(this._activeScene=t.object),this._updateScene(e);let n=new o.AssetsManager(t.object);n.useDefaultLoadingScreen=!1,this._assetManagers.set(t.object.uid,n)}),this.queries.scene.changed.forEach(e=>{this._updateScene(e)}),this.queries.scene.removed.forEach(e=>{let t=e.getComponent(r.Scene);a.disposeObject(t)})}_updateScene(e){let t=e.getComponent(r.Scene);for(let n in t)switch(n){case"texture":c.updateTexture(t,t.texture,this.getAssetManager(e));break;case"color":this._updateColor(t,t.color);break;default:a.updateObjectValue(t,n)}}_updateColor(e,t){for(let n in t)switch(n){case"clear":e.object[n+"Color"]=c.hexToColor4(t[n]);break;default:e.object[n+"Color"]=c.hexToColor3(t[n])}}start(e,t,n,s){return this._engine=new o.Engine(e,t,n,s),this._engine.runRenderLoop(this._render),this}switchScene(e){return this._activeScene=e.getComponent(r.Scene).object,this.onSceneSwitched.notifyObservers(this._activeScene),this}getAssetManager(e){return e?this._assetManagers.get(e.getComponent(r.Scene).object.uid):this._assetManagers.get(this._activeScene.uid)}_render(){i.getWorld(this).execute(this._engine.getDeltaTime(),performance.now()),i.getWorld(this).enabled&&this._activeScene.render()}}t.GameSystem=u,u.queries={scene:{components:[r.Scene],listen:{added:!0,removed:!0,changed:[r.Scene]}}}},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(14),t),s(n(1),t),s(n(28),t),s(n(43),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Scene=void 0;t.Scene=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=void 0;const o=n(4);t.Transform=class{constructor(){this.position=o.xyz(),this.rotation=o.xyz(),this.scale=o.xyz(1,1,1)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWorld=void 0,t.getWorld=function(e){return e.world}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const o=n(13),s=n(8),r=o.Game.instance();r.start(document.getElementById("mainCanvas"),[s.MeshSystem,s.LightSystem,s.MaterialSystem,s.InputSystem]);const i=r.createScene({clear:"#4DD0D5D9"}),a=r.createEntity().addComponent(s.Camera,{scene:i,pointerLock:!1});a.getMutableComponent(s.Transform).position.y=3,a.getMutableComponent(s.Transform).position.z=-3,a.getMutableComponent(s.Transform).position.x=-3,a.getMutableComponent(s.Transform).rotation.y=45,a.getMutableComponent(s.Transform).rotation.x=15;const c=r.createEntity().addComponent(s.Mesh,{scene:i}).addComponent(s.Material,{scene:i,color:{diffuse:"#330099"}});c.getMutableComponent(s.Transform).position.y=1,c.getMutableComponent(s.Transform).position.z=1,c.getMutableComponent(s.Transform).position.x=1;r.createEntity().addComponent(s.Light,{scene:i}).getMutableComponent(s.Light).direction.y=1;r.createEntity().addComponent(s.Mesh,{scene:i,type:s.MeshTypes.Ground,options:{width:10,height:10}}).addComponent(s.Material,{scene:i,texture:{diffuse:{url:"https://i0.wp.com/www.sharetextures.com/wp-content/uploads/2018/09/zebra_skin.jpg-diffuse.jpg?ssl=1",uScale:5,vScale:5},bump:{url:"https://i2.wp.com/www.sharetextures.com/wp-content/uploads/2018/09/zebra_skin.jpg-normal.jpg?ssl=1",uScale:5,vScale:5},specular:{url:"https://i1.wp.com/www.sharetextures.com/wp-content/uploads/2018/09/zebra_skin.jpg-specular.jpg?ssl=1",uScale:5,vScale:5}}});window.game=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;const o=n(0),s=n(8);class r extends o.World{constructor(){super()}get entities(){return this.entityManager._entities}get systems(){return this.systemManager._systems}get gameSystem(){return this.getSystem(s.GameSystem)}static instance(){return this._game||(this._game=new r),this._game}start(e,t){return this.registerSystem(s.GameSystem).registerSystem(s.TransformSystem).registerSystem(s.CameraSystem),t.forEach(e=>this.registerSystem(e)),this.gameSystem.start(e),this}createEntity(){return super.createEntity().addComponent(s.Transform)}createScene(e){return super.createEntity().addComponent(s.Scene,{color:e})}showDebugger(){this.gameSystem.activeScene.debugLayer.show()}}t.Game=r},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(7),t),s(n(21),t),s(n(22),t),s(n(23),t),s(n(24),t),s(n(25),t),s(n(26),t),s(n(27),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Camera=void 0;t.Camera=class{constructor(){this.pointerLock=!1}}},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Mesh=t.MeshTypes=void 0,function(e){e.Box="Box",e.Plane="Plane",e.Sphere="Sphere",e.Ground="Ground",e.Url="Url"}(o=t.MeshTypes||(t.MeshTypes={}));t.Mesh=class{constructor(){this.type=o.Box}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Light=t.LightTypes=void 0;const o=n(4);var s;!function(e){e.Point="Point",e.Directional="Directional",e.Spot="Spot",e.Hemispheric="Hemispheric"}(s=t.LightTypes||(t.LightTypes={}));t.Light=class{constructor(){this.type=s.Hemispheric,this.direction=o.xyz()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Material=void 0;const o=n(6);t.Material=class{constructor(){this.color=o.materialColorHex()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Particle=t.ParticleTypes=void 0;const o=n(4);var s;!function(e){e.Point="Point",e.Box="Box",e.Sphere="Sphere",e.DirectedSphere="DirectedSphere",e.Hemisphere="Hemisphere",e.Cylinder="Cylinder",e.DirectedCylinder="DirectedCylinder",e.Cone="Cone"}(s=t.ParticleTypes||(t.ParticleTypes={}));t.Particle=class{constructor(){this.type=s.Point,this.capacity=100,this.emitter=o.xyz(),this.direction1=o.xyz(),this.direction2=o.xyz(10,10,10),this.minEmitBox=o.xyz(),this.maxEmitBox=o.xyz()}}},function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.Input=t.InputTypes=void 0,function(e){e.Keyboard="Keyboard"}(o=t.InputTypes||(t.InputTypes={}));t.Input=class{constructor(){this.type=o.Keyboard}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransformSystem=void 0;const o=n(0),s=n(1),r=n(2);class i extends o.System{execute(){this.queries.transforms.changed.forEach(e=>{r.updateObjectsTransform(e)})}}t.TransformSystem=i,i.queries={transforms:{components:[s.Transform],listen:{changed:[s.Transform]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSystem=void 0;const o=n(3),s=n(0),r=n(1),i=n(5),a=n(2),c=n(7);class u extends s.System{constructor(){super(...arguments),this._cameras=new Map}init(){i.getSystem(this,c.GameSystem).onSceneSwitched.add(e=>this._updateControl(e)),this._pointerLock=this._pointerLock.bind(this)}execute(){this.queries.camera.added.forEach(e=>{let t=e.getComponent(r.Camera),n=i.getScene(this,t.scene);t.object=new o.FreeCamera("",o.Vector3.Zero(),n),a.updateObjectsTransform(e),this._cameras.set(n.uid,t),this._updateControl(n)}),this.queries.camera.removed.forEach(e=>{let t=e.getComponent(r.Camera),n=i.getScene(this,t.scene);this._removeControl(n),this._cameras.has(n.uid)&&this._cameras.delete(n.uid),a.disposeObject(t)})}_updateControl(e){if(e.uid===i.getScene(this).uid){i.getScenes(this).forEach(e=>this._removeControl(e));let t=this._cameras.get(e.uid);t.object.attachControl(i.getRenderingCanvas(this)),t.pointerLock?e.onPointerObservable.add(this._pointerLock):document.exitPointerLock()}}_removeControl(e){this._cameras.forEach((t,n)=>n===e.uid&&t.object.detachControl(i.getRenderingCanvas(this))),e.onPointerObservable.removeCallback(this._pointerLock)}_pointerLock(e){"pointerdown"===e.event.type&&(document.pointerLockElement||i.getRenderingCanvas(this).requestPointerLock())}}t.CameraSystem=u,u.queries={camera:{components:[r.Camera],listen:{added:!0,removed:!0}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MeshSystem=void 0;const o=n(3),s=n(0),r=n(1),i=n(5),a=n(2),c=n(2);class u extends s.System{execute(){this.queries.mesh.added.forEach(e=>{this._updateMesh(e,e.getComponent(r.Mesh))}),this.queries.mesh.changed.forEach(e=>{c.disposeObject(e.getComponent(r.Mesh)),this._updateMesh(e,e.getComponent(r.Mesh))}),this.queries.mesh.removed.forEach(e=>{c.disposeObject(e.getComponent(r.Mesh))})}_updateMesh(e,t){switch(t.type){case r.MeshTypes.Url:t.url&&o.SceneLoader.IsPluginForExtensionAvailable(this._fileExt(t.url))?this._loadUrlMesh(e,t,t.url):this._unsupportedMesh(e,t);break;default:t.object=o.MeshBuilder["Create"+t.type].call(this,t.type,t.options?t.options:{},i.getScene(this,t.scene)),this._updateMeshValue(t),a.updateObjectsTransform(e)}}_fileExt(e){return e.substring(e.lastIndexOf("."),e.length)}_loadUrlMesh(e,t,n){let o=i.getAssetManager(this,t.scene),s=n.lastIndexOf("/")+1,r=o.addMeshTask(t.type,"",n.substring(0,s),n.substring(s,n.length));r.onSuccess=n=>{t.object=n.loadedMeshes[0],this._updateMeshValue(t),a.updateObjectsTransform(e)},r.onError=()=>{this._unsupportedMesh(e,t)},o.load(),o.reset()}_updateMeshValue(e){for(let t in e)a.updateObjectValue(e,t)}_unsupportedMesh(e,t){let n=i.getScene(this,t.scene);t.object=o.MeshBuilder.CreatePlane("",{},n);let s=new o.StandardMaterial("",n);s.diffuseTexture=new o.Texture("data:errorData",n,!1,!1,2,null,null,"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABAAgMAAADXB5lNAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURSgoKCgoKCgoKO88OVVpm6AAAAACdFJOU/LlgHlY8AAAAP9JREFUOMvN1MFtwzAMBVB3nU7RcQsSKDcI96EPvrPAZ0nZkRUZKXKMb36xPr+UxMvX8nB9LDRdy+fj/ff7gES4bKYUBPYDdLOQcEgDY1cx6AqIjUADQFYvUNohkAFBEbFP+Y1MRAPboU1JOKdUj8rgp1BLWo+jaQutQUdotDuqMS+eRxblzM8F3kHDkIAD8kNxcBbukCuidmADaILcITOheST/g2wDVIYEX+Gckj2q7NkjmyYMTRlU4K/+HJQNEWttGDtIwZZffgcH8rkJgtFBC2h44oYCHeCWoRztUBugQP0E15pCP32JyzT2AiZT0zyL2gvd4T3+YpeXwfy6+ANZO9QlB5svlAAAAABJRU5ErkJggg==",!0),t.object.material=s,a.updateObjectsTransform(e)}}t.MeshSystem=u,u.queries={mesh:{components:[r.Mesh],listen:{added:!0,removed:!0,changed:[r.Mesh]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LightSystem=void 0;const o=n(3),s=n(0),r=n(1),i=n(5),a=n(6),c=n(4),u=n(2);class d extends s.System{execute(){this.queries.light.added.forEach(e=>{let t=e.getComponent(r.Light),n=c.xyzToVector3(t.direction),s=i.getScene(this,t.scene);switch(t.type){case r.LightTypes.Point:t.object=new o.PointLight(t.type,o.Vector3.Zero(),s);break;case r.LightTypes.Directional:t.object=new o.DirectionalLight(t.type,n,s);break;case r.LightTypes.Spot:t.object=new o.SpotLight(t.type,o.Vector3.Zero(),n,c.degreeToRadians(t.angle),t.exponent,s);break;default:t.object=new o.HemisphericLight(r.LightTypes.Hemispheric,n,s)}this._updateLight(t),u.updateObjectsTransform(e)}),this.queries.light.changed.forEach(e=>{this._updateLight(e.getComponent(r.Light))}),this.queries.light.removed.forEach(e=>{u.disposeObject(e.getComponent(r.Light))})}_updateLight(e){for(let t in e)switch(t){case"direction":u.updateObjectVector3(e,t);break;case"color":this._updateColor(e,e.color);break;default:u.updateObjectValue(e,t)}}_updateColor(e,t){for(let n in t)e.object[n]=a.hexToColor3(t[n])}}t.LightSystem=d,d.queries={light:{components:[r.Light],listen:{added:!0,removed:!0,changed:[r.Light]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialSystem=void 0;const o=n(3),s=n(0),r=n(1),i=n(5),a=n(2),c=n(6);class u extends s.System{execute(){this.queries.meshMaterial.added.forEach(e=>{if(!this._isUrlMesh(e)){let t=e.getComponent(r.Material);t.object=new o.StandardMaterial(t.color.diffuse,i.getScene(this,t.scene)),this._updateMaterial(t),e.getComponent(r.Mesh).object.material=t.object}}),this.queries.meshMaterial.changed.forEach(e=>{this._isUrlMesh(e)||this._updateMaterial(e.getComponent(r.Material))}),this.queries.meshMaterial.removed.forEach(e=>{this._isUrlMesh(e)||(a.disposeObject(e.getComponent(r.Material)),e.getComponent(r.Mesh).object.material=null)})}_isUrlMesh(e){return e.getComponent(r.Mesh).type===r.MeshTypes.Url}_updateMaterial(e){for(let t in e)switch(t){case"color":this._updateColor(e,e.color);break;case"texture":c.updateTexture(e,e.texture,i.getAssetManager(this,e.scene));break;default:a.updateObjectValue(e,t)}}_updateColor(e,t){for(let n in t)e.object[n+"Color"]=c.hexToColor3(t[n])}}t.MaterialSystem=u,u.queries={meshMaterial:{components:[r.Mesh,r.Material],listen:{added:!0,removed:!0,changed:[r.Material]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleSystem=void 0;const o=n(3),s=n(0),r=n(1),i=n(5),a=n(4),c=n(2),u=n(6);class d extends s.System{execute(){this.queries.particle.added.forEach(e=>{let t=e.getComponent(r.Particle);t.object=new o.ParticleSystem(t.type,t.capacity,i.getScene(this,t.scene));let n=t.object;switch(t.type){case r.ParticleTypes.Point:n.createPointEmitter(a.xyzToVector3(t.direction1),a.xyzToVector3(t.direction2));break;case r.ParticleTypes.Box:n.createBoxEmitter(a.xyzToVector3(t.direction1),a.xyzToVector3(t.direction2),a.xyzToVector3(t.minEmitBox),a.xyzToVector3(t.maxEmitBox));break;case r.ParticleTypes.Sphere:n.createSphereEmitter(t.radius,t.radiusRange);break;case r.ParticleTypes.DirectedSphere:n.createDirectedSphereEmitter(t.radius,a.xyzToVector3(t.direction1),a.xyzToVector3(t.direction2));break;case r.ParticleTypes.Hemisphere:n.createHemisphericEmitter(t.radius,t.radiusRange);break;case r.ParticleTypes.Cylinder:n.createCylinderEmitter(t.radius,t.height,t.radiusRange,Math.random());break;case r.ParticleTypes.DirectedCylinder:n.createDirectedCylinderEmitter(t.radius,t.height,t.radiusRange,a.xyzToVector3(t.direction1),a.xyzToVector3(t.direction2));break;case r.ParticleTypes.Cone:n.createConeEmitter(t.radius,t.angle)}this._updateParticle(t),c.updateObjectsTransform(e),n.start()}),this.queries.particle.changed.forEach(e=>{this._updateParticle(e.getComponent(r.Particle))}),this.queries.particle.removed.forEach(e=>{let t=e.getComponent(r.Particle);t.object.stop(),c.disposeObject(t)})}_updateParticle(e){for(let t in e)switch(t){case"emitter":case"direction1":case"direction2":case"minEmitBox":case"maxEmitBox":c.updateObjectVector3(e,t);break;case"texture":u.updateTexture(e,e.texture,i.getAssetManager(this,e.scene));break;case"color":this._updateColor(e,e.color);break;default:c.updateObjectValue(e,t)}}_updateColor(e,t){for(let n in t)e.object[n]=u.hexToColor4(t[n])}}t.ParticleSystem=d,d.queries={particle:{components:[r.Particle],listen:{added:!0,removed:!0,changed:[r.Particle]}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InputSystem=void 0;const o=n(0),s=n(1),r=n(5),i=n(7);class a extends o.System{constructor(){super(...arguments),this._inputs=new Map}init(){r.getSystem(this,i.GameSystem).onSceneSwitched.add(e=>this._updateOnKey(e)),this._onKey=this._onKey.bind(this)}execute(){this.queries.input.added.forEach(e=>{let t=e.getComponent(s.Input),n=r.getScene(this,t.scene);t.type,this._inputs.has(n.uid)||(this._inputs.set(n.uid,t),this._updateOnKey(n))}),this.queries.input.removed.forEach(e=>{let t=e.getComponent(s.Input),n=r.getScene(this,t.scene);t.type,this._inputs.has(n.uid)&&(this._inputs.delete(n.uid),this._removeOnKey(n))})}_updateOnKey(e){e.uid===r.getScene(this).uid&&(r.getScenes(this).forEach(e=>this._removeOnKey(e)),this._input=this._inputs.get(e.uid),this._input.onKey&&e.onKeyboardObservable.add(this._onKey))}_removeOnKey(e){e.onKeyboardObservable.removeCallback(this._onKey)}_onKey(e){this._input.onKey.call(this._input,e.event.key,1===e.type,2===e.type)}}t.InputSystem=a,a.queries={input:{components:[s.Input],listen:{added:!0,removed:!0}}}},function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(29),t),s(n(30),t),s(n(31),t),s(n(32),t),s(n(33),t),s(n(34),t),s(n(35),t),s(n(36),t),s(n(37),t),s(n(38),t),s(n(39),t),s(n(40),t),s(n(41),t),s(n(42),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(5);Object.defineProperty(t,"getScene",{enumerable:!0,get:function(){return o.getScene}}),Object.defineProperty(t,"getAssetManager",{enumerable:!0,get:function(){return o.getAssetManager}});var s=n(4);Object.defineProperty(t,"degreeToRadians",{enumerable:!0,get:function(){return s.degreeToRadians}}),Object.defineProperty(t,"xyzToVector3",{enumerable:!0,get:function(){return s.xyzToVector3}}),Object.defineProperty(t,"xyzToVector3Radians",{enumerable:!0,get:function(){return s.xyzToVector3Radians}});var r=n(6);Object.defineProperty(t,"hexToColor3",{enumerable:!0,get:function(){return r.hexToColor3}}),Object.defineProperty(t,"hexToColor4",{enumerable:!0,get:function(){return r.hexToColor4}})}]);